# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∞ –≤ –ø–∞–ø–∫—É. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–æ—Ç–∞—Ü–∏–∏.

---

## üìå –¶–µ–ª—å:
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `/var/log/nginx/access.log` ‚Üí –≤ `/var/www/logs/access.log`
b
`/var/log/nginx/error.log` ‚Üí –≤ `/var/www/logs/access.log`
, **–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É**.

---

## üîß –®–∞–≥ 1: –°–æ–∑–¥–∞—ë–º —Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª:

```bash
sudo nano /usr/local/bin/copy_nginx_logs.sh
```

2. –í—Å—Ç–∞–≤—å –≤ —Ñ–∞–π–ª –≤–æ—Ç —ç—Ç–æ:

```bash
cp /var/log/nginx/access.log /var/www/logs/access.log
chown www-data:www-data /var/www/logs/access.log
chmod 644 /var/www/logs/access.log
cp /var/log/nginx/error.log /var/www/logs/error.log
chown www-data:www-data /var/www/logs/error.log
chmod 644 /var/www/logs/error.log
```

> –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç –ª–æ–≥, –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –ø—Ä–∞–≤–∞, —á—Ç–æ–±—ã Nginx –∏ –±—Ä–∞—É–∑–µ—Ä –º–æ–≥–ª–∏ —á–∏—Ç–∞—Ç—å.

3. –°–æ—Ö—Ä–∞–Ω–∏ –∏ –≤—ã–π–¥–∏:
- `Ctrl+O` ‚Üí Enter
- `Ctrl+X`

4. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
sudo chmod +x /usr/local/bin/copy_nginx_logs.sh
```
---
## ‚è∞ –®–∞–≥ 2: –î–æ–±–∞–≤–ª—è–µ–º –≤ `cron`

–û—Ç–∫—Ä–æ–µ–º `crontab` –æ—Ç `root`, —á—Ç–æ–±—ã –±—ã–ª –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º:

```bash
sudo crontab -e
```

–î–æ–±–∞–≤—å –≤ —Å–∞–º—ã–π –Ω–∏–∑ —Å—Ç—Ä–æ–∫—É:
–í `cron` –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äî 1 –º–∏–Ω—É—Ç–∞. –°—Ç—Ä–æ–∫–∞ –≤ crontab:
```bash
* * * * * /usr/local/bin/copy_nginx_logs.sh
```
–æ–∑–Ω–∞—á–∞–µ—Ç: **–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –≤ 0 —Å–µ–∫—É–Ω–¥** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç.

---

## ‚úÖ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ–¥–æ–∂–¥–∏ 1-2 –º–∏–Ω—É—Ç—ã, –ø–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω–∏:

```bash
ls -l /var/www/logs/access.log
```

–∏

```bash
tail /var/www/logs/access.log
```

–¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å —Å–≤–µ–∂–∏–µ –∑–∞–ø–∏—Å–∏. –ï—Å–ª–∏ –ª–æ–≥ –ø—É—Å—Ç–æ–π ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, —Å–∞–π—Ç –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ—Å–µ—â–∞–ª.

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–û—Ç–∫—Ä–æ–π —Å–∞–π—Ç —Å–æ —Å–≤–æ–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∑–∞–π–¥–∏ –Ω–∞ http://10.121.1.164), –ø–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—å:

```bash
tail /var/www/settings/access.log
```

–¢—ã —É–≤–∏–¥–∏—à—å, –∫–∞–∫–æ–π IP –∑–∞—Ö–æ–¥–∏–ª –∏ –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è–ª.

## ü§î –ê –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥?
–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π `cron` **–Ω–µ —É–º–µ–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á–∏ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É.** –ù–æ –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–±–æ–π—Ç–∏ —ç—Ç–æ:


### ‚úÖ **–í–∞—Ä–∏–∞–Ω—Ç 1: –î–≤–∞ –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ `cron` (–Ω–µ–º–Ω–æ–≥–æ –∫–æ—Å—Ç—ã–ª—å, –Ω–æ —Ä–∞–±–æ—á–∏–π)**

–û—Ç–∫—Ä—ã–≤–∞–µ—à—å `sudo crontab -e` –∏ –¥–æ–±–∞–≤–ª—è–µ—à—å **–¥–≤–∞ –∑–∞–¥–∞–Ω–∏—è**:

```bash
* * * * * /usr/local/bin/copy_nginx_log.sh
* * * * * sleep 30 && /usr/local/bin/copy_nginx_log.sh
```

–ü–µ—Ä–≤–∞—è ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π –º–∏–Ω—É—Ç—ã, –≤—Ç–æ—Ä–∞—è ‚Äî —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞. –ü–æ–ª—É—á–∞–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ **—Ä–∞–∑ –≤ 30 —Å–µ–∫—É–Ω–¥**.

> `sleep 30` –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Ç–æ—Ä—É—é –∑–∞–¥–∞—á—É –ø–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–ª–º–∏–Ω—É—Ç—ã –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.

---

### ‚úÖ **–í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ü–∏–∫–ª–µ (–Ω–∞–¥–µ–∂–Ω–µ–µ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç systemd –∏–ª–∏ screen)**

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –±–æ–ª–µ–µ –≥–∏–±–∫–æ –∏ —Ç–æ—á–Ω–æ, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Å `sleep 30`:

1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
sudo nano /usr/local/bin/copy_nginx_loop.sh
```

2. –í—Å—Ç–∞–≤—å –≤ –Ω–µ–≥–æ:

```bash
#!/bin/bash
while true; do
    /usr/local/bin/copy_nginx_log.sh
    sleep 30
done
```

3. –°–¥–µ–ª–∞–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
sudo chmod +x /usr/local/bin/copy_nginx_loop.sh
```

4. –ó–∞–ø—É—Å—Ç–∏ –≤ —Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ `screen` –∏–ª–∏ `nohup`:

```bash
nohup /usr/local/bin/copy_nginx_loop.sh &
```

> `nohup` = –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–µ—Å—Å–∏–∏.

